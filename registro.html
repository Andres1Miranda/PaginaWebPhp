<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CO-MUSICA | REGISTRO USUARIO</title>
</head>
<body>
    <div class="content">
            <!-- Formulario para crear usuario -->
            <div class="form-section">
                <h2>Crear Nuevo Usuario</h2>
                <form id="usuarioForm">
                    <div class="form-group">
                        <label for="nombre">Nombre:</label>
                        <input type="text" id="nombre" name="nombre" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Contraseña:</label>
                        <input type="password" id="password" name="password" required>
                    </div>
                    <button type="submit" class="btn">Crear Usuario</button>
                </form>
            </div>
    </div>

    <script>
        const API_BASE_URL = 'https://databaseweb-c3716-default-rtdb.firebaseio.com/';

        // Función para mostrar mensajes
        function mostrarMensaje(mensaje, tipo = 'success') {
            const container = document.getElementById('mensajes');
            const div = document.createElement('div');
            div.className = tipo;
            div.textContent = mensaje;
            container.appendChild(div);
            
            setTimeout(() => {
                div.remove();
            }, 5000);
        }

        // Función para crear usuario
        document.getElementById('usuarioForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const usuario = {
                nombre: formData.get('nombre'),
                email: formData.get('password'),
            };

            try {
                const response = await fetch(`${API_BASE_URL}/usuarios`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(usuario)
                });

                const data = await response.json();

                if (data.success) {
                    mostrarMensaje('Usuario creado exitosamente', 'success');
                    e.target.reset();
                    cargarUsuarios();
                } else {
                    mostrarMensaje(`Error: ${data.error}`, 'error');
                }
            } catch (error) {
                mostrarMensaje(`Error de conexión: ${error.message}`, 'error');
            }
        });

        // Función para cargar usuarios
       /* async function cargarUsuarios() {
            const container = document.getElementById('usuariosContainer');
            container.innerHTML = '<div class="loading">Cargando usuarios...</div>';

            try {
                const response = await fetch(`${API_BASE_URL}/usuarios`);
                const data = await response.json();

                if (data.success) {
                    if (data.data.length === 0) {
                        container.innerHTML = '<div class="loading">No hay usuarios registrados</div>';
                        return;
                    }

                    container.innerHTML = '';
                    data.data.forEach(usuario => {
                        const usuarioCard = crearUsuarioCard(usuario);
                        container.appendChild(usuarioCard);
                    });
                } else {
                    container.innerHTML = `<div class="error">Error: ${data.error}</div>`;
                }
            } catch (error) {
                container.innerHTML = `<div class="error">Error de conexión: ${error.message}</div>`;
            }
        }*/

        // Función para crear card de usuario
        function crearUsuarioCard(usuario) {
            const card = document.createElement('div');
            card.className = 'usuario-card';
            card.innerHTML = `
                <div class="usuario-info">
                    <div class="info-item">
                        <span class="info-label">ID</span>
                        <span class="info-value">${usuario.id}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Nombre</span>
                        <span class="info-value">${usuario.nombre}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Email</span>
                        <span class="info-value">${usuario.email}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Edad</span>
                        <span class="info-value">${usuario.edad || 'No especificada'}</span>
                    </div>
                </div>
                <div>
                    <button onclick="eliminarUsuario('${usuario.id}')" class="btn btn-danger">Eliminar</button>
                    <button onclick="editarUsuario('${usuario.id}')" class="btn btn-warning">Editar</button>
                </div>
            `;
            return card;
        }

        // Función para eliminar usuario
        async function eliminarUsuario(id) {
            if (!confirm('¿Estás seguro de que quieres eliminar este usuario?')) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/usuarios/${id}`, {
                    method: 'DELETE'
                });

                const data = await response.json();

                if (data.success) {
                    mostrarMensaje('Usuario eliminado exitosamente', 'success');
                    cargarUsuarios();
                } else {
                    mostrarMensaje(`Error: ${data.error}`, 'error');
                }
            } catch (error) {
                mostrarMensaje(`Error de conexión: ${error.message}`, 'error');
            }
        }

        // Función para editar usuario (simplificada)
        async function editarUsuario(id) {
            const nuevoNombre = prompt('Nuevo nombre:');
            if (!nuevoNombre) return;

            const nuevoEmail = prompt('Nuevo email:');
            if (!nuevoEmail) return;

            const nuevaEdad = prompt('Nueva edad (opcional):');

            try {
                const response = await fetch(`${API_BASE_URL}/usuarios/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        nombre: nuevoNombre,
                        email: nuevoEmail,
                        edad: nuevaEdad ? parseInt(nuevaEdad) : null
                    })
                });

                const data = await response.json();

                if (data.success) {
                    mostrarMensaje('Usuario actualizado exitosamente', 'success');
                    cargarUsuarios();
                } else {
                    mostrarMensaje(`Error: ${data.error}`, 'error');
                }
            } catch (error) {
                mostrarMensaje(`Error de conexión: ${error.message}`, 'error');
            }
        }

        // Función para test de API
        async function testApi() {
            try {
                const response = await fetch(`${API_BASE_URL}/test`);
                const data = await response.json();

                if (data.success) {
                    mostrarMensaje('API funcionando correctamente ✅', 'success');
                } else {
                    mostrarMensaje('API no responde correctamente ❌', 'error');
                }
            } catch (error) {
                mostrarMensaje(`Error de conexión: ${error.message}`, 'error');
            }
        }

        // Cargar usuarios al iniciar
        window.addEventListener('load', () => {
            // Comentado para que no cargue automáticamente
            // cargarUsuarios();
        });
    </script>
</body>
</html>